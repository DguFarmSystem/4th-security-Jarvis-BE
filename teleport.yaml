#
# A Sample Teleport configuration file.
#
# Things to update:
#  1. license.pem: Retrieve a license from your Teleport account https://teleport.sh
#     if you are an Enterprise customer.
#
version: v3
teleport:
  nodename: 26dc41c9ca07
  data_dir: /var/lib/teleport
  join_params:
    token_name: ""
    method: token
  log:
    output: stderr
    severity: INFO
    format:
      output: text
  ca_pin: ""
  diag_addr: ""
auth_service:
  enabled: "yes"
  listen_addr: 0.0.0.0:3025
  proxy_listener_mode: multiplex
  public_addr: "openswdev.duckdns.org:3080"
  cluster_name: "openswdev.duckdns.org"
  authentication:
    type: local
ssh_service:
  enabled: "no"
proxy_service:
  enabled: "yes"
  public_addr: openswdev.duckdns.org:3080
  https_keypairs:
    - cert_file: /etc/letsencrypt/live/openswdev.duckdns.org/fullchain.pem
      key_file: /etc/letsencrypt/live/openswdev.duckdns.org/privkey.pem

  https_keypairs_reload_interval: 0s
  acme: {}
  http_headers:
    # 1. CSP 규칙: 웹 UI('self') 외에 API 서버로의 연결('connect-src')을 허용합니다.
    - "Content-Security-Policy: connect-src 'self' wss: https://openswdev-api.duckdns.org:3080"

    # 2. CORS 규칙: 웹 UI 주소에서 오는 API 요청을 허용('Access-Control-Allow-Origin')합니다.
    - "Access-Control-Allow-Origin: https://openswdev.duckdns.org:3080"
    - "Access-Control-Allow-Credentials: 'true'"
app_service:
  enabled: true
  apps:
    - name: grafana
      uri: "http://grafana:3333"
      labels:
        env: "test"
    - name: "my-backend-api"
      # 1. 외부에서 접속할 공개 주소를 추가합니다.
      public_addr: "openswdev-api.duckdns.org"
      # 2. 내부 uri는 Go 앱이 실행되는 주소로 지정합니다.
      #    Teleport와 Go 앱이 같은 서버에 있으므로 localhost 사용이 가능합니다.
      uri: "http://172.17.0.1:8080"
db_service:
  enabled: "yes"
  databases:
  - name: "example-mysql"
    protocol: "mysql"
    uri: "test-database:3306"
